<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How To Create a Plugin for an Envisage Application &mdash; Envisage Documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../_static/enthought.css" type="text/css" >
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" >
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" >
    <link rel="stylesheet" href="../_static/enthought.css" type="text/css" >
    <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" >
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        LINK_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '.txt',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
    <script type="text/javascript" src="../_static/clipboard.min.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="../_static/js/copybutton.js"></script>
    <script type="text/javascript" src="../_static/js/wrap_on_dot.js"></script>
    <link rel="shortcut icon" href="../_static/img/favicon.png">
    <link rel="index" title="Index" href="../genindex.html" >
    <link rel="search" title="Search" href="../search.html" >
    <link rel="top" title="Envisage Documentation" href="../index.html" >
    <link rel="up" title="Envisage Core Documentation" href="index.html" >
    <link rel="next" title="The “Message of the Day” (MOTD) Example" href="message_of_the_day.html" >
    <link rel="prev" title="Plugins" href="plugins.html" > 
  </head>
  <body>
  <div class="container">
    <div class="header">
    </div>
  </div>

    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="../index.html">Envisage Documentation</a></li>
	
          <li class="active"><a href="index.html" accesskey="U">Envisage Core Documentation</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="../py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
      <li class="active">
        <a href="message_of_the_day.html" title="The “Message of the Day” (MOTD) Example"
           accesskey="N">next</a>
      </li>
      <li class="active">
        <a href="plugins.html" title="Plugins"
           accesskey="P">previous</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body" role="main">
            
  <section id="how-to-create-a-plugin-for-an-envisage-application">
<h1>How To Create a Plugin for an Envisage Application<a class="headerlink" href="#how-to-create-a-plugin-for-an-envisage-application" title="Permalink to this heading">¶</a></h1>
<p>This document describes the process of creating an Envisage plugin that works
with a Workbench-based application.</p>
<p>There are several questions to consider when designing a plugin:</p>
<ul class="simple">
<li><p>What does it do?</p></li>
<li><p>What functionality does it offer to other plugins?</p></li>
<li><p>What does it add to what other plugins already do?</p></li>
<li><p>What does it need from other plugins?</p></li>
</ul>
<section id="what-does-your-plugin-do">
<h2>What Does Your Plugin Do?<a class="headerlink" href="#what-does-your-plugin-do" title="Permalink to this heading">¶</a></h2>
<p>“What your plugin does” refers to the basic functionality that your plugin
adds to the application.</p>
<p>Very often, you want to take some pre-existing chunk of functionality (module,
library, etc.) and make it available within the Envisage application. Assuming
the library has a well-defined API, you do not need to alter it in any way. You
only create the plugin code to wrap it for Envisage.</p>
<p>Sometimes, however, you are designing a new chunk of functionality just for
the Envisage application. In this case, step back and think about how you
would design the core functionality of the plugin, independent of Envisage. It
is important to keep this separate from the plugin machinery that make that
functionality work within Envisage.</p>
<p>In either case, we will refer to the code that does this core functionality as
“the library”.</p>
<section id="example-library">
<h3>Example Library<a class="headerlink" href="#example-library" title="Permalink to this heading">¶</a></h3>
<p>Suppose you have a library that implements a game of Tetris. You want to add
this game to an Envisage application that lets users pick a game to play from
a catalog of available games. You have a Tetris class that looks something
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Tetris</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>

    <span class="c1"># Basic colors</span>
    <span class="n">background_color</span> <span class="o">=</span> <span class="n">Color</span>
    <span class="n">foreground_color</span> <span class="o">=</span> <span class="n">Color</span>

    <span class="c1"># Shapes to use in the game</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">IShape</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>In the following sections, we’ll look at ways that this library can be
integrated into the application by a plugin.</p>
</section>
</section>
<section id="what-does-your-plugin-offer-to-other-plugins">
<h2>What Does Your Plugin Offer to Other Plugins?<a class="headerlink" href="#what-does-your-plugin-offer-to-other-plugins" title="Permalink to this heading">¶</a></h2>
<p>There are two ways that a plugin can provide functionality to other
plugins.</p>
<ul class="simple">
<li><p><strong>Offering services:</strong> Your plugin may provide an API, the core functionality
of your library, as a service. Yours might be the only provider of that type
of service in an application, or it might be one of many.</p></li>
<li><p><strong>Defining extension points:</strong> Your plugin may offer one or more extension
points, which means that your plugin will do something specific with
contributions to that extension point. Contributions to an extension point
must be instances of a type or interface that you specify. An extension point
is a trait attribute whose type is ExtensionPoint, which consists of a List
of some other type, plus an ID. In other words, an extension point is a list,
used by your plugin, that is populated by plugins.</p></li>
</ul>
<section id="examples-of-offering-functionality-to-other-plugins">
<h3>Examples of Offering Functionality to Other Plugins<a class="headerlink" href="#examples-of-offering-functionality-to-other-plugins" title="Permalink to this heading">¶</a></h3>
<p>Suppose that the games application defines an “IGame” interface that it uses to
control games, with methods for starting, stopping, displaying scores, and so
on. In this case, you offer the Tetris library as a service that implements the
“IGame” interface used by the application. (You might need to create an adapter
for your Tetris class to the IGame interface, but we’ll ignore that.)</p>
<p>You can manually register a service, but a simple way to do it is to contribute
to the ‘envisage.services_offers’ extension point of the Core plugin.
This ensures that the plugin is registered, and is created when it is needed.</p>
<p>You also want to allow users to contribute their own Tetris shapes, so you
define an extension point for shapes. We’ll leave aside the question of how
users actually define their shapes. The point is that the catalog of shapes is
extensible. (You would probably also contribute some basic shapes from your
plugin, so that users don’t <em>need</em> to contribute any.)</p>
</section>
</section>
<section id="what-does-your-plugin-add-to-other-plugins">
<h2>What Does Your Plugin Add to Other Plugins?<a class="headerlink" href="#what-does-your-plugin-add-to-other-plugins" title="Permalink to this heading">¶</a></h2>
<p>Other plugins may provide extension points that are useful to your plugin. If
so, you can contribute to those extension points. Essentially, your plugin
passes one or more objects to the plugin whose extension point you are
contributing to, and that plugin “does the right thing” with those items.</p>
<section id="examples-of-contributing-to-extension-points">
<h3>Examples of Contributing to Extension Points<a class="headerlink" href="#examples-of-contributing-to-extension-points" title="Permalink to this heading">¶</a></h3>
<p>Continuing the example of the Tetris game, the application might keep a list
of available games, and present the list for the user to select from. Thus, it
might have a ‘games’ extension point, to which you can contribute an object
containing information about your Tetris game, such as name, description, icon,
and entry point.</p>
<p>More concretely, you want to specify default colors for the foreground and
background colors of the game, but allow users to change them and save their
changes across sessions. For specifying default preference values and saving
changed values, you can contribute to the ‘envisage.preferences’
extension point offered by the Envisage core plugin; for a UI to change
preferences, you can contribute to the
‘envisage.ui.workbench.preferences_pages’ extension point offered by
the Workbench plugin. (A game application probably wouldn’t use the Workbench
plugin, but we’ll assume it does to avoid using a fictional plugin.)</p>
<p>A contribution to the preferences extension point must be a URL of a preferences
file (readable by ConfigObj). A plugin typically has only one preferences file,
even if it has many categories of preferences.</p>
<p>A contribution to the preference_pages extension point must be a callable that
returns an object that implements the
<cite>apptools.preferences.ui.api.IPreferencesPage</cite> interface. Such an object
typically has a Traits UI view that can be used in the Preferences dialog box to
set the values of the preference attributes. A plugin may have multiple
preferences pages, depending on how it groups the items to be configured.</p>
<p>There are two strategies for defining a callable that returns an object:</p>
<ul class="simple">
<li><p>Subclass from a class that implements the interface, in this case
<cite>apptools.preferences.ui.api.PreferencesPage</cite>.</p></li>
<li><p>Define a factory function that returns an appropriate object. This strategy
is not needed for preferences pages, but can be helpful when the object
being returned contains a reference to a service.</p></li>
</ul>
<p>In either case, the contribution is a trait attribute on the plugin object.</p>
</section>
</section>
<section id="what-does-your-plugin-need-from-other-plugins">
<h2>What Does Your Plugin Need from Other Plugins?<a class="headerlink" href="#what-does-your-plugin-need-from-other-plugins" title="Permalink to this heading">¶</a></h2>
<p>Your plugin may need to use the API of some other plugin. In Envisage, you use
the other plugin’s API via a service, rather than directly. This allows for the
plugin offering the service to be replaced with another one, transparently to
your plugin. There may be multiple plugins offering a particular type of
service, but a client plugin uses only one instance of a service at any given
time.</p>
<section id="example-of-using-a-service">
<h3>Example of Using a Service<a class="headerlink" href="#example-of-using-a-service" title="Permalink to this heading">¶</a></h3>
<p>The service you use may be your own. For the Tetris game, the object that you
contribute to the application’s ‘games’ extension point needs to be able to
start the game. However, to reduce memory overhead, you don’t want the Tetris
library to be imported until the user actually chooses to play Tetris. Using the
service offered by the Tetris plugin is a way to accomplish that.</p>
</section>
</section>
<section id="complete-example">
<h2>Complete Example<a class="headerlink" href="#complete-example" title="Permalink to this heading">¶</a></h2>
<p>The complete plugin for the Tetris game might look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TetrisPlugin</span><span class="p">(</span><span class="n">Plugin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plugin to make the Tetris library available in Envisage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### Extension points offered by the plugin</span>

    <span class="c1">#: Shapes to be used in the game</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">ExtensionPoint</span><span class="p">(</span><span class="n">List</span><span class="p">(</span><span class="n">IShape</span><span class="p">),</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;acme.tetris.shapes&#39;</span><span class="p">)</span>

    <span class="c1">### Contributions to extension points</span>

    <span class="n">my_shapes</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="s1">&#39;acme.tetris.shapes&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_my_shapes_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Trait initializer for &#39;my_shapes&#39; contribution to this plugin&#39;s</span>
<span class="sd">            own &#39;shapes&#39; extension point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Shape1</span><span class="p">(),</span> <span class="n">Shape2</span><span class="p">(),</span> <span class="n">Shape3</span><span class="p">()]</span>

    <span class="n">games</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="s1">&#39;acme.game_player.game_infos&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_games_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Trait initializer for &#39;games&#39; contribution to the application</span>
<span class="sd">            plugin&#39;s &#39;games&#39; extension point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">GameInfo</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Tetris&#39;</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;tetris.png&#39;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Classic shape-fitting puzzle game&#39;</span><span class="p">,</span>
                <span class="n">entry_point</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_game</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>

    <span class="n">preferences</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="s1">&#39;envisage.preferences&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_preferences_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Trait initializer for &#39;preferences&#39; contribution. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;pkgfile://acme.tetris.plugin/preferences.ini&#39;</span><span class="p">]</span>

    <span class="n">preferences_pages</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span>
        <span class="n">contributes_to</span><span class="o">=</span><span class="s1">&#39;envisage.ui.workbench.preferences_pages&#39;</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_preferences_pages_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Trait initializer for &#39;preferences_pages&#39; contribution. &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">acme.tetris.plugin.preferences_pages</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">TetrisPreferencesPages</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">TetrisPreferencesPages</span><span class="p">]</span>

    <span class="n">services_offers</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="s1">&#39;envisages.service_offers&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_service_offers_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Trait initializer for &#39;service_offers&#39; contribution. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">ServiceOffer</span><span class="p">(</span>
                <span class="n">protocol</span><span class="o">=</span><span class="n">IGame</span><span class="p">,</span>
                <span class="n">factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_tetris_service</span><span class="p">,</span>
                <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;tetris&#39;</span><span class="p">},</span>
            <span class="p">),</span>
        <span class="p">]</span>

    <span class="c1">#### Private interface #################################################</span>

    <span class="k">def</span> <span class="nf">_create_tetris_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Factory method for the Tetris service. &quot;&quot;&quot;</span>
        <span class="n">tetris</span> <span class="o">=</span> <span class="n">Tetris</span><span class="p">()</span> <span class="c1"># This creates the non-Envisage library object.</span>

        <span class="c1"># Hook up the extension point contributions to the library object trait.</span>
        <span class="n">bind_extension_point</span><span class="p">(</span><span class="n">tetris</span><span class="p">,</span> <span class="s1">&#39;shapes&#39;</span><span class="p">,</span> <span class="s1">&#39;acme.tetris.shapes&#39;</span><span class="p">)</span>

        <span class="c1"># Hook up the preferences to the library object traits.</span>
        <span class="n">bind_preference</span><span class="p">(</span>
            <span class="n">tetris</span><span class="p">,</span> <span class="s1">&#39;background_color&#39;</span><span class="p">,</span> <span class="s1">&#39;acme.tetris.background_color&#39;</span>
        <span class="p">)</span>
        <span class="n">bind_preference</span><span class="p">(</span>
            <span class="n">tetris</span><span class="p">,</span> <span class="s1">&#39;foreground_color&#39;</span><span class="p">,</span> <span class="s1">&#39;acme.tetris.foreground_color&#39;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">tetris</span>

    <span class="k">def</span> <span class="nf">_start_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Starts a Tetris game. &quot;&quot;&quot;</span>
        <span class="n">game</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">get_service</span><span class="p">(</span><span class="n">IGame</span><span class="p">,</span> <span class="s2">&quot;name == &#39;tetris&#39;&quot;</span><span class="p">)</span>
        <span class="n">game</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/img/e-logo.png" alt="Logo">
            </a></p>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">How To Create a Plugin for an Envisage Application</a><ul>
<li><a class="reference internal" href="#what-does-your-plugin-do">What Does Your Plugin Do?</a><ul>
<li><a class="reference internal" href="#example-library">Example Library</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-does-your-plugin-offer-to-other-plugins">What Does Your Plugin Offer to Other Plugins?</a><ul>
<li><a class="reference internal" href="#examples-of-offering-functionality-to-other-plugins">Examples of Offering Functionality to Other Plugins</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-does-your-plugin-add-to-other-plugins">What Does Your Plugin Add to Other Plugins?</a><ul>
<li><a class="reference internal" href="#examples-of-contributing-to-extension-points">Examples of Contributing to Extension Points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-does-your-plugin-need-from-other-plugins">What Does Your Plugin Need from Other Plugins?</a><ul>
<li><a class="reference internal" href="#example-of-using-a-service">Example of Using a Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-example">Complete Example</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="plugins.html"
                          title="previous chapter">Plugins</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="message_of_the_day.html"
                          title="next chapter">The “Message of the Day” (MOTD) Example</a></p>
  </div>
  <h3>This Page</h3>
  <div>
    <a href="../_sources/envisage_core_documentation/howto_create_a_plugin.rst.txt"
       rel="nofollow">Show Source</a>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2007-2023, Enthought
      </li>
      <li>
      Last updated on Apr 03, 2023.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 6.1.3.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>