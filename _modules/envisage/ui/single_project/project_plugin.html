<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>envisage.ui.single_project.project_plugin &mdash; Envisage Documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../../../../_static/enthought.css" type="text/css" >
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" >
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '4.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../../_static/js/copybutton.js"></script>
    <script type="text/javascript" src="../../../../_static/js/wrap_on_dot.js"></script>
    <link rel="shortcut icon" href="../../../../_static/img/favicon.ico">
    <link rel="index" title="Index" href="../../../../genindex.html" >
    <link rel="search" title="Search" href="../../../../search.html" >
    <link rel="top" title="Envisage Documentation" href="../../../../index.html" >
    <link rel="up" title="Module code" href="../../../index.html" > 
  </head>
  <body>
  <div class="container">
    <div class="header">
    </div>
  </div>

    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="../../../../index.html">Envisage Documentation</a></li>
	
          <li class="active"><a href="../../../index.html" accesskey="U">Module code</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../../../../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="../../../../py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <h1>Source code for envisage.ui.single_project.project_plugin</h1><div class="highlight"><pre>
<span></span><span class="c1"># (C) Copyright 2007-2019 Enthought, Inc., Austin, TX</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># This software is provided without warranty under the terms of the BSD</span>
<span class="c1"># license included in LICENSE.txt and may be redistributed only</span>
<span class="c1"># under the conditions described in the aforementioned license.  The license</span>
<span class="c1"># is also available online at http://www.enthought.com/licenses/BSD.txt</span>
<span class="c1"># Thanks for using Enthought open source!</span>
<span class="sd">&quot;&quot;&quot; The Envisage single project plugin. &quot;&quot;&quot;</span>

<span class="c1"># Standard library imports</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># Enthought library imports.</span>
<span class="kn">from</span> <span class="nn">envisage.api</span> <span class="k">import</span> <span class="n">ExtensionPoint</span><span class="p">,</span> <span class="n">Plugin</span><span class="p">,</span> <span class="n">ServiceOffer</span>
<span class="kn">from</span> <span class="nn">envisage.ui.single_project.api</span> <span class="k">import</span> <span class="n">FactoryDefinition</span>
<span class="kn">from</span> <span class="nn">pyface.action.api</span> <span class="k">import</span> <span class="n">MenuManager</span>
<span class="kn">from</span> <span class="nn">pyface.workbench.api</span> <span class="k">import</span> <span class="n">Perspective</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span>

<span class="c1"># Local imports.</span>
<span class="kn">from</span> <span class="nn">.model_service</span> <span class="k">import</span> <span class="n">ModelService</span>
<span class="kn">from</span> <span class="nn">.project_action_set</span> <span class="k">import</span> <span class="n">ProjectActionSet</span>
<span class="kn">from</span> <span class="nn">.services</span> <span class="k">import</span> <span class="n">IPROJECT_MODEL</span><span class="p">,</span> <span class="n">IPROJECT_UI</span>
<span class="kn">from</span> <span class="nn">.ui_service_factory</span> <span class="k">import</span> <span class="n">UIServiceFactory</span>

<span class="c1"># This module&#39;s package.</span>
<span class="n">PKG</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Setup a logger for this module.</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
<span class="c1"># `ProjectPerspective` class.</span>
<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="ProjectPerspective"><a class="viewcode-back" href="../../../../api/envisage.ui.single_project.html#envisage.ui.single_project.project_plugin.ProjectPerspective">[docs]</a><span class="k">class</span> <span class="nc">ProjectPerspective</span><span class="p">(</span><span class="n">Perspective</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A default perspective for the single_project plugin.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The perspective&#39;s name.</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Project&#39;</span>

    <span class="c1"># Should this perspective be enabled or not?</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Should the editor area be shown in this perspective?</span>
    <span class="n">show_editor_area</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># The contents of the perspective.</span>
    <span class="c1"># TODO: Setup the PerspectiveItems based on the areas in our perspective.</span>
    <span class="c1">#contents = []</span>

<span class="c1">##############################################################################</span>
<span class="c1"># &#39;ProjectPlugin&#39; class.</span>
<span class="c1">##############################################################################</span>
<div class="viewcode-block" id="ProjectPlugin"><a class="viewcode-back" href="../../../../api/envisage.ui.single_project.html#envisage.ui.single_project.project_plugin.ProjectPlugin">[docs]</a><span class="k">class</span> <span class="nc">ProjectPlugin</span><span class="p">(</span><span class="n">Plugin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The single-project plugin.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The Ids of the extension points that this plugin offers.</span>
    <span class="n">ACTION_SETS</span>       <span class="o">=</span> <span class="s1">&#39;envisage.ui.workbench.action_sets&#39;</span>
    <span class="n">FACTORY_DEFINITIONS</span> <span class="o">=</span> <span class="s1">&#39;envisage.ui.single_project.factory_definitions&#39;</span>
    <span class="n">UI_SERVICE_FACTORY</span> <span class="o">=</span> <span class="s1">&#39;envisage.ui.single_project.ui_service_factory&#39;</span>

    <span class="c1"># The Ids of the extension points that this plugin contributes to.</span>
    <span class="n">PERSPECTIVES</span> <span class="o">=</span> <span class="s1">&#39;envisage.ui.workbench.perspectives&#39;</span>
    <span class="n">PREFERENCES</span> <span class="o">=</span> <span class="s1">&#39;envisage.preferences&#39;</span>
    <span class="n">PREFERENCES_PAGES</span> <span class="o">=</span> <span class="s1">&#39;envisage.ui.workbench.preferences_pages&#39;</span>
    <span class="n">SERVICE_OFFERS</span> <span class="o">=</span> <span class="s1">&#39;envisage.service_offers&#39;</span>
    <span class="n">VIEWS</span> <span class="o">=</span> <span class="s1">&#39;envisage.ui.workbench.views&#39;</span>

    <span class="c1">#### &#39;IPlugin&#39; interface ##################################################</span>

    <span class="c1"># The plugin&#39;s unique identifier.</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;envisage.ui.single_project&#39;</span>

    <span class="c1"># The plugin&#39;s name (suitable for displaying to the user).</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Single Project&#39;</span>

    <span class="c1">#### Extension points offered by this plugin ##############################</span>

    <span class="c1"># Factory definitions.</span>
    <span class="n">factory_definitions</span> <span class="o">=</span> <span class="n">ExtensionPoint</span><span class="p">(</span>
        <span class="n">List</span><span class="p">(</span><span class="n">Callable</span><span class="p">),</span> <span class="nb">id</span><span class="o">=</span><span class="n">FACTORY_DEFINITIONS</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        A project factory definition.</span>

<span class="s2">        An instance of the specified class is used to open and/or create new</span>
<span class="s2">        projects.</span>

<span class="s2">        The extension with the highest priority wins!  In the event of a tie,</span>
<span class="s2">        the first instance wins.</span>

<span class="s2">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Ui service factories.</span>
    <span class="n">ui_service_factory</span> <span class="o">=</span> <span class="n">ExtensionPoint</span><span class="p">(</span>
        <span class="n">List</span><span class="p">(</span><span class="n">Callable</span><span class="p">),</span> <span class="nb">id</span><span class="o">=</span><span class="n">UI_SERVICE_FACTORY</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        A ui service factory definition.</span>

<span class="s2">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1">#### Contributions to extension points made by this plugin ################</span>

    <span class="c1"># Action sets.</span>
    <span class="n">action_sets</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="n">ACTION_SETS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_action_sets_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default project actions.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">ProjectActionSet</span><span class="p">]</span>

    <span class="c1"># Factory definitions.</span>
    <span class="n">my_factory_definitions</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="n">FACTORY_DEFINITIONS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_my_factory_definitions_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default factory definition.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">factory_definition</span> <span class="o">=</span> <span class="n">FactoryDefinition</span><span class="p">(</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">PKG</span> <span class="o">+</span> <span class="s1">&#39;.project_factory.ProjectFactory&#39;</span><span class="p">,</span>
            <span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">factory_definition</span><span class="p">]</span>

    <span class="c1"># Perspectives.</span>
    <span class="n">perspectives</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="n">PERSPECTIVES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_perspectives_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default project perspective.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">ProjectPerspective</span><span class="p">]</span>

    <span class="c1"># Service offers.</span>
    <span class="n">service_offers</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="n">SERVICE_OFFERS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_service_offers_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Our service contributions.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">model_service</span> <span class="o">=</span> <span class="n">ServiceOffer</span><span class="p">(</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="n">IPROJECT_MODEL</span><span class="p">,</span>
            <span class="n">factory</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_model_service</span>
        <span class="p">)</span>

        <span class="n">ui_service</span> <span class="o">=</span> <span class="n">ServiceOffer</span><span class="p">(</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="n">IPROJECT_UI</span><span class="p">,</span>
            <span class="n">factory</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_ui_service</span>
        <span class="p">)</span>

        <span class="c1"># FIXME: Eventually we will register the services here intead</span>
        <span class="c1"># of in the plugin&#39;s start() method.</span>
        <span class="c1">#return [model_service, ui_service]</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Ui service factories.</span>
    <span class="n">my_ui_service_factory</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="n">UI_SERVICE_FACTORY</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_my_ui_service_factory_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default ui service factory.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ui_service_factory</span> <span class="o">=</span> <span class="n">UIServiceFactory</span><span class="p">(</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">PKG</span> <span class="o">+</span> <span class="s1">&#39;.ui_service_factory.UIServiceFactory&#39;</span><span class="p">,</span>
            <span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">ui_service_factory</span><span class="p">]</span>

    <span class="c1"># Preferences.</span>
    <span class="n">my_preferences</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="n">PREFERENCES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_my_preferences_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default preferences.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;pkgfile://</span><span class="si">%s</span><span class="s1">/preferences.ini&#39;</span> <span class="o">%</span> <span class="n">PKG</span><span class="p">]</span>

    <span class="c1"># Preference pages.</span>
    <span class="n">my_preferences_pages</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="n">PREFERENCES_PAGES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_my_preferences_pages_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default preference page.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.default_path_preference_page</span> <span class="k">import</span> <span class="n">DefaultPathPreferencePage</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">DefaultPathPreferencePage</span><span class="p">]</span>

    <span class="c1"># Views.</span>
    <span class="n">views</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">contributes_to</span><span class="o">=</span><span class="n">VIEWS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_views_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add our project views.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_view_factory</span><span class="p">]</span>

    <span class="c1">### protected interface ##################################################</span>

<div class="viewcode-block" id="ProjectPlugin.start"><a class="viewcode-back" href="../../../../api/envisage.ui.single_project.html#envisage.ui.single_project.project_plugin.ProjectPlugin.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts the plugin.</span>

<span class="sd">        Overridden here to start up our services and load the project</span>
<span class="sd">        that was open when we were last shut-down.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ProjectPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># FIXME: We eventually won&#39;t have to explicitly register the</span>
        <span class="c1"># services ourselves, since we contribute them as service offers</span>
        <span class="c1"># so they are instantiated when they are invoked, but since they are</span>
        <span class="c1"># not used anywhere else yet, I had to use this same old approach</span>
        <span class="c1"># just to test and make sure they were working correctly.</span>
        <span class="c1"># Create and register the model service we offer</span>
        <span class="n">model_service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_model_service</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">register_service</span><span class="p">(</span><span class="n">IPROJECT_MODEL</span><span class="p">,</span> <span class="n">model_service</span><span class="p">)</span>

        <span class="c1"># Create and register the ui service we offer</span>
        <span class="n">ui_service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_ui_service</span><span class="p">(</span><span class="n">model_service</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">register_service</span><span class="p">(</span><span class="n">IPROJECT_UI</span><span class="p">,</span> <span class="n">ui_service</span><span class="p">)</span>

        <span class="c1"># Set up any listeners interested in the current project selection</span>
        <span class="c1"># FIXME: Register the selection listeners for the current project selection.</span>
        <span class="c1">#self._register_selection_listeners(model_service)</span>

        <span class="k">return</span></div>

    <span class="c1">######################################################################</span>
    <span class="c1"># Private methods.</span>
    <span class="k">def</span> <span class="nf">_project_view_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Factory method for project views.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pyface.workbench.traits_ui_view</span> <span class="k">import</span> \
                <span class="n">TraitsUIView</span>
        <span class="kn">from</span> <span class="nn">envisage.ui.single_project.api</span> <span class="k">import</span> \
                            <span class="n">ProjectView</span>

        <span class="n">project_view</span> <span class="o">=</span> <span class="n">ProjectView</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
        <span class="n">tui_project_view</span> <span class="o">=</span> <span class="n">TraitsUIView</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">project_view</span><span class="p">,</span>
                                       <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;envisage.ui.single_project.view.project_view.ProjectView&#39;</span><span class="p">,</span>
                                       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Project View&#39;</span><span class="p">,</span>
                                       <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span>
                                       <span class="n">position</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                       <span class="o">**</span><span class="n">traits</span>
                                       <span class="p">)</span>
        <span class="k">return</span> <span class="n">tui_project_view</span>

    <span class="k">def</span> <span class="nf">_create_model_service</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a model service for this plugin.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Determine which contributed project factory to use.</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_contributed_project_factory</span><span class="p">()</span>

        <span class="c1"># Make sure the factory has a reference to our Envisage application.</span>
        <span class="n">factory</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span>

        <span class="c1"># Create the project service instance.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ModelService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>


    <span class="k">def</span> <span class="nf">_create_ui_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_service</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a UI service for this plugin.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create the menu manager representing the context menu we show when</span>
        <span class="c1"># nothing is selected in the project view.</span>
        <span class="n">menu_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_no_selection_context_menu_manager</span><span class="p">()</span>

        <span class="c1"># Get the UI service factory.</span>
        <span class="n">ui_service_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_contributed_ui_service_factory</span><span class="p">()</span>

        <span class="c1"># Create the ui service instance</span>
        <span class="n">ui_service</span> <span class="o">=</span> <span class="n">ui_service_factory</span><span class="o">.</span><span class="n">create_ui_service</span><span class="p">(</span><span class="n">model_service</span><span class="p">,</span>
            <span class="n">menu_manager</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ui_service</span>


    <span class="k">def</span> <span class="nf">_get_contributed_project_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the instance of the project factory to use with this</span>
<span class="sd">        plugin.</span>

<span class="sd">        The instance is generated from the contributed factory definition</span>
<span class="sd">        that was the first one with the highest priority.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Retrieve all the factory definition contributions</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">get_extensions</span><span class="p">(</span><span class="s1">&#39;envisage.ui.single_project.factory_definitions&#39;</span><span class="p">)</span>

        <span class="c1"># Find the winning contribution</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">definition</span> <span class="ow">or</span> <span class="n">extension</span><span class="o">.</span><span class="n">priority</span> <span class="o">&gt;</span> <span class="n">definition</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
                <span class="n">definition</span> <span class="o">=</span> <span class="n">extension</span>

        <span class="c1"># Create an instance of the winning project factory</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using ProjectFactory [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">definition</span><span class="o">.</span><span class="n">class_name</span><span class="p">)</span>
        <span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">import_symbol</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">class_name</span><span class="p">)</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">factory</span>


    <span class="k">def</span> <span class="nf">_get_contributed_ui_service_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the instance of the UiService factory to use with this</span>
<span class="sd">        plugin.</span>

<span class="sd">        The instance is generated from the contributed factory definition</span>
<span class="sd">        that was the first one with the highest priority.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Retrieve all the factory definition contributions</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extensions</span><span class="p">(</span><span class="s1">&#39;envisage.ui.single_project.ui_service_factory&#39;</span><span class="p">)</span>

        <span class="c1"># Find the winning contribution</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">definition</span> <span class="ow">or</span> <span class="n">extension</span><span class="o">.</span><span class="n">priority</span> <span class="o">&gt;</span> <span class="n">definition</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
                <span class="n">definition</span> <span class="o">=</span> <span class="n">extension</span>

        <span class="c1"># Create an instance of the winning factory</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using UiService Factory [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">definition</span><span class="o">.</span><span class="n">class_name</span><span class="p">)</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">class_name</span>
        <span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">import_symbol</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">factory</span>


    <span class="k">def</span> <span class="nf">_get_no_selection_context_menu_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a menu manager representing the context menu shown when</span>
<span class="sd">        nothing is selected within the project view.  That is, when the</span>
<span class="sd">        user right clicks on any empty space within our associated UI.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Retrieve all contributions for the no-selection context menu.</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extensions</span><span class="p">(</span><span class="n">ProjectActionSet</span><span class="p">)</span>

        <span class="c1"># Populate a menu manager from the extensions.</span>
        <span class="n">menu_manager</span> <span class="o">=</span> <span class="n">MenuManager</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extensions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">action_set_manager</span> <span class="o">=</span> <span class="n">ActionSetManager</span><span class="p">(</span><span class="n">action_sets</span><span class="o">=</span><span class="n">extensions</span><span class="p">)</span>
            <span class="n">menu_builder</span> <span class="o">=</span> <span class="n">DefaultMenuBuilder</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
            <span class="n">menu_builder</span><span class="o">.</span><span class="n">initialize_menu_manager</span><span class="p">(</span><span class="n">menu_manager</span><span class="p">,</span>
                <span class="n">action_set_manager</span><span class="p">,</span> <span class="n">NO_SELECTION_MENU_ID</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">menu_manager</span>


    <span class="k">def</span> <span class="nf">_register_selection_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_service</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers any extension-requested listeners on the project</span>
<span class="sd">        selection.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">sps</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extensions</span><span class="p">(</span><span class="n">SyncProjectSelection</span><span class="p">):</span>
            <span class="nb">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">lookup_application_object</span><span class="p">(</span><span class="n">sps</span><span class="o">.</span><span class="n">uol</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_register_selection_handler</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">model_service</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Could not resolve the SyncProjectSelection &#39;</span> <span class="o">+</span> \
                    <span class="s1">&#39;UOL: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">uol</span> <span class="p">)</span>

        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">_register_selection_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">model_service</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a handler and registers it.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">handler</span><span class="p">():</span>
            <span class="c1"># The key to this method is to realize that our goal is to</span>
            <span class="c1"># make it as easy as possible to create recipients for</span>
            <span class="c1"># notification.  Using traits as the recipients makes</span>
            <span class="c1"># creation very simple because we can rely on the type</span>
            <span class="c1"># knowledge within that trait to ensure only valid values</span>
            <span class="c1"># get assigned to the recipient.  That is the recipient</span>
            <span class="c1"># doesn&#39;t need to do anything complex to validate the</span>
            <span class="c1"># values they get assigned.  This method also works if the</span>
            <span class="c1"># recipient isn&#39;t a trait, but in that case, they will</span>
            <span class="c1"># have to handle multiple selection of the project</span>
            <span class="c1"># bindings.</span>
            <span class="c1">#</span>
            <span class="c1"># First, try to provide the recipient with a multiple</span>
            <span class="c1"># selection type value i.e. a list of bindings.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">model_service</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># If that didn&#39;t work, remove the binding wrappers and try</span>
            <span class="c1"># notification of the resulting list.</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">obj</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">model_service</span><span class="o">.</span><span class="n">selection</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">selection</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># If that didn&#39;t work, and only a single item is selected,</span>
            <span class="c1"># then try to provide that item to the recipient.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">selection</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">return</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1"># The recipient must not be accepting the type of the</span>
            <span class="c1"># current selection, so let&#39;s clear its current selection</span>
            <span class="c1"># instead.  If this fails, then something has gone wrong</span>
            <span class="c1"># with the declaration of the recipient.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Error informing object [</span><span class="si">%s</span><span class="s1">] of project &#39;</span>
                    <span class="s1">&#39;selection change via attribute [</span><span class="si">%s</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="n">model_service</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="s1">&#39;selection&#39;</span><span class="p">)</span>
        <span class="n">model_service</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="s1">&#39;selection_items&#39;</span><span class="p">)</span>

        <span class="k">return</span></div>

<span class="c1">### EOF ######################################################################</span>
</pre></div>

          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/img/e-logo.png" alt="Logo">
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2008-2019, Enthought
      </li>
      <li>
      Last updated on Nov 19, 2019.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.5.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>